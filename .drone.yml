# New .drone.yml content
---
pipeline:
  BuildStart:
    image: hpreston/drone-ansible-netdevops
    commands:
      - echo "Starting Build"

  Install and Configure TestNetwork:
    image: hpreston/drone-ansible-netdevops
    commands:
      - "pip install -r requirements.txt"
      - "pip list"
      - "yamllint --strict *.yml"
      - "ansible-playbook test.yml"

  Verify TestNetwork:
    image: hpreston/drone-ansible-netdevops
    commands:
      - "pip install robotframework"
      - "pip install robotframework-sshlibrary"
      - "pip install -r requirements1.txt"
      - "pip list"
      - "yamllint --strict *.yml"
      - "robot verify_telnet.robot"

  ConfigProdNetwork:
    image: hpreston/drone-ansible-netdevops
    commands:
      - "pip install -r requirements.txt"
      - "pip list"
      - "ansible-playbook ntp_config.yml"

  SparkNotify:
    image: hpreston/drone-spark:0.7
    secrets: [ SPARK_TOKEN, personEmail, roomId, roomName ]
    message: "Build Done!"
    when:
      status: [ success, failure ]
