---
# Define the language and versions used. The CI system will create
# a Python virtualenv for each Python version to test it.
language: "python"
python:
  - "3.7"


# Install python packages for ansible and linters first.
install:
  - "pip install -r requirements.txt"

# Execute linting to catch minor errors before running the main playbook.
# Find all YAML files in the project and lint them in strict mode.
before_script:
  - "yamllint --strict *.yml"

# Perform playbook testing with on pre-existing virtual routers.
# A more complex pipeline might deploy on-demand routers ahead of time
# using Terraform rather than assume they already exist.
script:
  - "ansible-playbook test.yml"

deploy:
  provider: script
  script: "ansible-playbook ntp_config.yml"
  when: manual

notifications:
  webhooks:
    urls:
      - https://discord.com/api/webhooks/844921504864796683/G9Fp3EyxraksSpVdcw-MLzBI1muwDqCwiHQykQsG75Cn6gCbeP3-P1TY31xvW6UvnYI4
    on_success: always
    on_failure: always
    on_start: always
    on_cancel: always

after_success:
  - wget:
      https://raw.githubusercontent.com/DiscordHooks/travis-ci-discord-webhook/master/send.sh
  - chmod +x send.sh
  - ./send.sh success $WEBHOOK_URL
after_failure:
  - chmod +x send.sh
  - ./send.sh failure $WEBHOOK_URL
